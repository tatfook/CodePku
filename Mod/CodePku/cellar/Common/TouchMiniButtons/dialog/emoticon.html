<!-- "Mod/CodePku/cellar/Common/TouchMiniButtons/MainUIButtons_dialog.html" -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
</head>

<body>
<pe:mcml>
<script refresh="false" type="text/npl" src="MainSceneUIButtons.lua"><![CDATA[
    local MainSceneUIButtons = commonlib.gettable("Mod.CodePku.Common.TouchMiniButtons.MainSceneUIButtons");
    local GameLogic = commonlib.gettable("MyCompany.Aries.Game.GameLogic");
    Emoticons = MainSceneUIButtons.Emoticons

    function OnClose()
        Page:CloseWindow()
        MainSceneUIButtons.show_dialog_ui(false, 0)
    end

    function OnChoose(name)
        echo("choooseEmoticon====================="..name);
        GameLogic.GetPlayerController():SaveLocalData("choooseEmoticon", name, true);
        local emoName = GameLogic.GetPlayerController():LoadLocalData("choooseEmoticon", "", true);
        echo("localData====================="..emoName);

        Page:CloseWindow()
        MainSceneUIButtons.show_dialog_ui(false, 0)

        local page = document:GetPageCtrl()


        --local words = page:GetValue("DialogContent")
        if not emoName or emoName == '' then
            return
        end
      
        if not sendable then
            GameLogic.RunCommand("/tip -duration 1500 发言太频繁，请稍后尝试")
            return
        end
        sendable = false
        local times = 2
        local timer = commonlib.Timer:new({
            callbackFunc = function(timer)

                if times == 0 then
                    sendable = true
                    timer:Change(nil, nil)
                end

                times = times - 1
            end
        })
        timer:Change(1000, 1000)
        CodepkuChatChannel.SendWorldMsg(words)
        Page:Refresh()
    end


]]></script>
<style type="text/mcss">
</style>
<pe:container alignment="_ct" width="100%" height="100%">
    <div style="width:1920;height:1080;position:absolute;" onclick="OnClose">
        <!-- 表情 -->
        <div style="width:598;height:345;background-color:white;position: relative;left: 336;top:601px;">
            <pe:gridview style="width: 598; height: 345; background-color:white; text-align: center;"  name='backpack_items' LineWidth="598"  DataSource="<%=Emoticons%>" DefaultNodeHeight = "143" ItemsPerLine="5" AllowPaging="false" RememberScrollPos="true" RememberLastPage="true"> 
                <Columns>
                    <div style="<%=format('margin-top: 59;margin-left: 28;width:86;height:84;background: url(%s);',Eval('url'))%>" name="<%=Eval('name')%>" title="<%=Eval('title')%>" onclick="OnChoose"></div>
                </Columns>
            </pe:gridview>
        </div>
    </div>
</pe:container>
</pe:mcml> 
</body>
</html>