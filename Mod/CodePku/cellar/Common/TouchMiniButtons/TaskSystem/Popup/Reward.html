<!-- "Mod/CodePku/cellar/Gui/FriendUI/MyFriend.html" -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
</head>

<body>
<pe:mcml>
<script refresh="false" type="text/npl" src="FriendUI.lua">
<![CDATA[

TaskSystem = NPL.load("(gl)Mod/CodePku/cellar/Common/TouchMiniButtons/TaskSystem/TaskSystem.lua")

task_table = TaskSystem.task_table  --任务表

reward_table = TaskSystem.reward_table -- 奖励表

acquire_flag = TaskSystem.acquire_flag

nowReward = TaskSystem.nowReward

function ClosePage()
    Page:CloseWindow();
end

rewardNum_table = {{1},{2},{3}}

function getText()
    if(nowReward["status"] == 1)then
        return "领取"
    else
        return "确认"
    end
end

function getBG()
    if(nowReward["status"] == 1)then
        return "694 582 207 87:15 15 15 15"
    else
        return "694 450 207 87:15 15 15 15"
    end
end

function getRewardInfo()
    return TaskSystem:ChangeStrToNum(nowReward["reward_json"])
end

function getRwardBG(type)
    local index = tonumber(index)
    local info = nowReward["reward_json"]
    echo("---------getRwardBG-----------")
    echo(info)
    return info[index]["prop_icon_url"]
    --return "https://scratch-works-staging-1253386414.file.myqcloud.com/game/admin/propIcons/2.png"
end

function handleReward()
    if(nowReward["status"] == 1) then    -- 如果奖励未领取且可领取
        TaskSystem:GetReward(nowReward["id"])
        Page:Refresh(0)
    end
end

reward_marginLeft = {"376", "293", "209", "115", "32"}

function getMarginLeft()
    local rewardInfo = TaskSystem:ChangeStrToNum(nowReward["reward_json"])
    local length = #rewardInfo
    return reward_marginLeft[length]
end

]]>
</script>

<pe:container alignment="_lt" width="1920" height="1080" >
    <div style="position: relative;width: 1920;height:1080;background-color: #00000099;" onclick="ClosePage"></div>
    <div style="position: relative; width: 952; height: 528; left: 484; top: 278; background: url(codepku/image/textures/tasksystem/reward_bg.png);"></div>

    <!-- <div style="position: relative; width: 1158; height: 588; left: 406; top: 219; background:url(codepku/image/textures/commonpopup/main.png#99 275 1158 588);"></div> -->

    <div style="position: relative; width: 410; height: 89; left: 755; top: 283; font-size: 46; line-height: 89; color: #F46D3D; font-family: Noto Sans S Chinese;font-weight: bold; text-align: center; background: url(codepku/image/textures/common_32bits.png#1277 377 410 87);">
        奖励信息
    </div>

    <div style="position: relative; width: 66; height: 76; left: 1335; top: 287; background: url(codepku/image/textures/tasksystem/main.png#897 111 64 74);" onclick="ClosePage"></div>

    <div style="position: relative; width: 952; height: 134; left: 484; top: 460;">

        <div style="<%=format('float:left; width: 1; height: 134; margin-left: %s;)', getMarginLeft())%>"></div>

        <div style="float: left;">
            <pe:repeat DataSource="<%=getRewardInfo()%>">
                <div style="float: left;width: 134; height: 134; margin-left: 33;">
                    <div style="<%= format('position: relative; left: 31;top: 31;width: 72; height: 72;background:url(%s);', getRwardBG(index)) %>"></div>
                    <div style="width: 134; height: 134;background:url(codepku/image/textures/common_32bits.png#99 873 134 134);"></div>
                    <div style="position: relative;top:-35;;width: 120; text-align: right; font-size: 22; color: #7996ed; font-family: Noto Sans S Chinese Regular;"><%=Eval('reward_num')%></div>
                </div>
                <!-- <div style="<%=format('width: 134; height: 134; margin-left: 33; float: left; background: url(codepku/image/textures/tasksystem/main.png#%s);', getRwardBG(reward_type))%>">
                    <div style="width: 48; margin-left: 68; margin-top: 98;  text-align: center; font-size: 22; color: #7996ED; font-family: Noto Sans S Chinese Regular;"><%=Eval('reward_num')%></div>
                </div> -->
            </pe:repeat>
        </div>
    </div>

    <div style="<%=format('position: relative; width: 200; height: 80; left: 860; top: 660; color: #FEFEFE; line-height: 80; text-align: center; font-size: 36; font-family: Noto Sans S Chinese Regular; font-weight: bold; background: url(codepku/image/textures/tasksystem/main.png#%s);', getBG())%>" onclick="handleReward"><%=getText()%></div>
    
</pe:container>
</pe:mcml>
</body>

</html>