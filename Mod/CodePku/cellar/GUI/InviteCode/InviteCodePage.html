<!-- "script/apps/Aries/Creator/Game/Areas/EscFramePage.html" -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
</head>
<body>
<pe:mcml>
<script refresh="false" type="text/npl" src="InviteCode.lua"><![CDATA[
InviteCode = NPL.load("(gl)Mod/CodePku/cellar/GUI/InviteCode/InviteCode.lua")
InviteCode.window = Page

function OnclickReceive(id)
    --GameLogic.AddBBS("CodeGlobals", tostring(id), 3000, "#00FF00");
    InviteCode.GetAward(id)
    Page:Refresh(0)
end

function OnclickRecord()
    InviteCode.ifInviteRecord = if_else(InviteCode.ifInviteRecord==false, true, false)
    if InviteCode.ifInviteRecord == true then
        InviteCode.GetRecord()
    else
        Page:Refresh(0)
    end
end

function OnInviteCodeChange()
    InviteCode.CheckVisitor()
end

function OnclickBand()
    local inviteCode = Page:GetValue("inviteCode")
    if inviteCode == "" or commonlib.utf8.len(inviteCode) ~= commonlib.utf8.len(InviteCode.invite_code) then
        GameLogic.AddBBS("CodeGlobals", L"请输入六位邀请码", 3000, "#FF0000");
    else
        inviteCode = string.match(inviteCode, "[%u%d]+")
        if inviteCode and commonlib.utf8.len(inviteCode) == commonlib.utf8.len(InviteCode.invite_code) then
            InviteCode.Band(inviteCode)
        else
            GameLogic.AddBBS("CodeGlobals", L"邀请码只能是数字和大写字母组成", 3000, "#FF0000");
        end

    end
end

function OnclickCopyCode()
    InviteCode.InviteCopy()
end

function OnclickInviteFriends()
    InviteCode.InviteShare()
end

function OnclickClose()
    if InviteCode.BG then 
        InviteCode.BG:CloseWindow()
        InviteCode.BG = nil
    end

    Page:CloseWindow()
    InviteCode.window = nil
end

InviteCode.Init()
]]>
</script>
<pe:container alignment="_ct" width="1779" height="969" style="font-family: zkklt; color: #743c20;">
<!-- 背景 -->
<div style="<%=format('position: relative; left: 0; top: 0; width: 1779; height: 969; background:url(%s);', InviteCode.GetIconUrl('invite_popup_bg.png'))%>">

    <!-- 标题 -->
    <div style="<%=format('position: relative; left: 37; top: -29; width: 298; height: 130; background:url(%s);', InviteCode.GetIconUrl('invite_popup_tab.png'))%>"></div>
    <div style="<%=format('position: relative; left: 81; top: 1; width: 188; height: 45; background:url(%s);', InviteCode.GetIconUrl('invite_popup_title0.png'))%>"></div>

    <!-- 横幅 -->
    <div style="<%=format('position: relative; left: 149; top: 93; width: 1484; height: 147; background:url(%s);', InviteCode.GetIconUrl('invite_popup_frame.png'))%>">
        <div style="position: relative; left: 59; top: 50; width: 1401; height: 67; font-size: 30;">
            <%= string.format("%s-%s期间，每邀请一名新的同学注册玩学世界（非游客）并绑定你的邀请码，即可领取丰厚奖励。每个用户最多可领取累积10位好友的奖励，快来邀请好友一起来玩学世界吧！", InviteCode.start_time or '2020.11.20', InviteCode.end_time or '2020.2.20') %>
        </div>
    </div>

    <!-- 绑定好友 -->
    <div style="<%=format('position: relative; left: 160; top: 296; width: 126; height: 30; background:url(%s);', InviteCode.GetIconUrl('invite_popup_title.png'))%>"></div>
    <div style="<%=format('position: relative; left: 159; top: 345; width: 660; height: 238; background:url(%s);', InviteCode.GetIconUrl('invite_popup_frame1.png'))%>">
        <pe:if condition="<%= InviteCode.bandRewards ~= nil %>">
            <div style="position: relative; left: 34; top: 55; width: 252; height: 25; font-size: 28;">绑定好友获取奖励：</div>
            <pe:if condition="<%= InviteCode.ifBanded == true %>">
                <div style="position: relative; left: 288; top: 54; width: 336; height: 28; font-size: 28; text-align: left; font-family: Noto Sans S Chinese Regular;"><%= InviteCode.bandName..'（已绑定）' %></div>
            </pe:if>
            <pe:if condition="<%= InviteCode.ifBanded == false %>">
                <div style="<%=format('position: relative; left: 271; top: 33; width: 168; height: 66; background:url(%s);', InviteCode.GetIconUrl('invite_popup_frame4.png'))%>">
                    <input type="text" MoveViewWhenAttachWithIME="true" name="inviteCode" onchange="OnInviteCodeChange" value="" EmptyText='输入邀请码' style="position: relative; left: 20; top: 24; width: 140; height: 28; font-size: 28; text-align: center; font-family: Noto Sans S Chinese Regular; background: #000000;"/>
                </div>
                <div onclick="OnclickBand" style="<%=format('position: relative; left: 480; top: 40; width: 146; height: 55; font-size: 30; color: #ffffff; text-align: center; line-height: 55; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_s_b.png'))%>">绑定</div>
            </pe:if>
            <div style="<%=format('position: relative; left: 211; top: 141; width: 43; height: 45; padding-left: 43; padding-top: 19; font-size: 26; font-family: Noto Sans S Chinese Regular; background:url(%s);', InviteCode.GetIconUrl('main_icon_coin_2.png'))%>"><%= string.format("x%d", InviteCode.bandRewards["2"]["prop_count"]) %></div>
            <div style="<%=format('position: relative; left: 328; top: 138; width: 43; height: 51; padding-left: 43; padding-top: 22; font-size: 26; font-family: Noto Sans S Chinese Regular; background:url(%s);', InviteCode.GetIconUrl('main_icon_coin_1.png'))%>"><%= string.format("x%d", InviteCode.bandRewards["1"]["prop_count"]) %></div>
            
            <pe:if condition="<%= InviteCode.ifBanded == false %>">
                <div style="<%=format('position: relative; left: 480; top: 134; width: 146; height: 55; font-size: 30; color: #ffffff; text-align: center; line-height: 55; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_s_g.png'))%>">领取</div>
            </pe:if>
    
            <pe:if condition="<%= InviteCode.ifBanded == true and InviteCode.ifBandAwardReceived == false %>">
                <div name="1" onclick="OnclickReceive" style="<%=format('position: relative; left: 480; top: 134; width: 146; height: 55; font-size: 30; color: #ffffff; text-align: center; line-height: 55; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_s_r.png'))%>">领取</div>
            </pe:if>
    
            <pe:if condition="<%= InviteCode.ifBanded == true and InviteCode.ifBandAwardReceived == true %>">
                <div style="<%=format('position: relative; left: 480; top: 134; width: 146; height: 55; font-size: 30; color: #ffffff; text-align: center; line-height: 55; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_s_g.png'))%>">已领取</div>
            </pe:if>
        </pe:if>
    </div>

    <!-- 左下角图片 -->
    <div style="<%=format('position: relative; left: 158; top: 627; width: 645; height: 258; background:url(%s);', InviteCode.GetIconUrl('invite_popup_image.png'))%>"></div>

    <!-- 邀请好友 -->
    <div style="<%=format('position: relative; left: 855; top: 289; width: 554; height: 31; background:url(%s);', InviteCode.GetIconUrl('invite_popup_title2.png'))%>"></div>
    <div onclick="OnclickRecord" style="<%=format('position: relative; left: 1467; top: 275; width: 179; height: 61; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_blue.png'))%>">
        <pe:if condition="<%= InviteCode.ifInviteRecord == true %>">
            <div  style="<%=format('position: relative; left: 54; top: 16; width: 71; height: 28; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_text_back.png'))%>"></div>
        </pe:if>
        <pe:if condition="<%= InviteCode.ifInviteRecord == false %>">
            <div onclick="OnclickRecord" style="<%=format('position: relative; left: 32; top: 15; width: 114; height: 30; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_text_invitation_records.png'))%>"></div>
        </pe:if>
    </div>
    <div style="<%=format('position: relative; left: 859; top: 345; width: 788; height: 414; background:url(%s);', InviteCode.GetIconUrl('invite_popup_frame2.png'))%>">
        <pe:if condition="<%= InviteCode.ifInviteRecord == true %>">
            <div style="position: relative; left: 42; top: 47; width: 210; height: 26; font-size: 30;">绑定我的好友：</div>
            <pe:if condition="<%= #InviteCode.inviteRecords == 0 %>">
                <div style="position: relative; left: 275; top: 49;width: 210; height: 30; font-size: 30; font-family: zkklt; color: #743c20;">暂无绑定记录</div>
            </pe:if>
            <pe:if condition="<%= #InviteCode.inviteRecords > 0 %>">
                <pe:gridview style="position: relative; left: 244; top: 18; width: 800; height: 400; " DataSource='<%= InviteCode.inviteRecords %>' CellPadding="31" ItemsPerLine="2" AllowPaging="false" RememberScrollPos="true" RememberLastPage="true" VerticalScrollBarStep="150" VerticalScrollBarOffsetX="8">
                    <Columns>
                        <div style="width: 210; height: 30; font-size: 30; font-family: zkklt; color: #743c20;"><%= name %></div>
                    </Columns>
                </pe:gridview>
            </pe:if>
        </pe:if>
        <pe:if condition="<%= InviteCode.ifInviteRecord == false %>">
            <pe:repeat DataSource="<%= InviteCode.inviteRewards %>">
                <pe:repeatitem>
                    <div style="float: left; margin-left: 31; margin-top: 53; margin-bottom: 13; font-size: 30; width: 360; height: 27;"><%= string.format("累计邀请%d位好友奖励：", invite_count) %></div>
                    <div style="<%=format('float: left; margin-left: -20; margin-top: 44; width: 43; height: 45; padding-left: 43; padding-top: 19; font-size: 26; font-family: Noto Sans S Chinese Regular; background:url(%s);', InviteCode.GetIconUrl('main_icon_coin_2.png'))%>"><%= string.format("x%d", reward_json["2"]["prop_count"]) %></div>
                    <div style="<%=format('float: left; margin-left: 59; margin-top: 41; width: 43; height: 51; padding-left: 43; padding-top: 22; font-size: 26; font-family: Noto Sans S Chinese Regular; background:url(%s);', InviteCode.GetIconUrl('main_icon_coin_1.png'))%>"><%= string.format("x%d", reward_json["1"]["prop_count"]) %></div>            
                    <pe:if condition="<%= reward_status == 2 %>">
                        <div style="<%=format('float: left; margin-left: 103; margin-top: 39; width: 146; height: 55; font-size: 30; color: #ffffff; text-align: center; line-height: 55; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_s_g.png'))%>">已领取</div>
                    </pe:if>
                    <pe:if condition="<%= reward_status == 3 %>">
                        <div name="<%= id %>" onclick="OnclickReceive" style="<%=format('float: left; margin-left: 103; margin-top: 39; width: 146; height: 55; font-size: 30; color: #ffffff; text-align: center; line-height: 55; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_s_r.png'))%>">领取</div>
                    </pe:if>
                    <pe:if condition="<%= reward_status == 1 %>">
                        <div style="<%=format('float: left; margin-left: 103; margin-top: 39; width: 146; height: 55; font-size: 30; color: #ffffff; text-align: center; line-height: 55; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_s_g.png'))%>">领取</div>
                    </pe:if>
                </pe:repeatitem>
            </pe:repeat>
        </pe:if>
    </div>

    <!-- 我的邀请码 -->
    <div style="position: relative; left: 942; top: 824; width: 210; height: 27; font-size: 30;">我的邀请码：</div>
    <div style="position: relative; left: 1113; top: 821; width: 180; height: 27; font-size: 30; font-family: Noto Sans S Chinese Regular;"><%= InviteCode.invite_code %></div>
    <!-- TODO剪贴板 -->
    <div onclick="OnclickCopyCode" style="<%=format('position: relative; left: 1252; top: 807; width: 179; height: 61; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_blue.png'))%>">
        <div style="<%=format('position: relative; left: 18; top: 15; width: 143; height: 30; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_text_copy.png'))%>"></div>
    </div>
    <pe:if condition="<%= System.os.IsMobilePlatform() %>">  
        <!-- TODO分享 -->
        <div onclick="OnclickInviteFriends" style="<%=format('position: relative; left: 1469; top: 807; width: 179; height: 61; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_red.png'))%>">
            <div style="<%=format('position: relative; left: 32; top: 15; width: 114; height: 30; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn_text_invite.png'))%>"></div>
        </div>
    </pe:if>

    <!-- 关闭 -->
    <div onclick="OnclickClose" style="<%=format('position: relative; left: 1635; top: -17; width: 77; height: 123; background:url(%s);', InviteCode.GetIconUrl('invite_popup_btn.png'))%>"></div>

</div>

</pe:container>
</pe:mcml>
</body>
</html>
 